# å€‹äººç­†é›»è£œåŠ©é·ç§»å·¥å…·

æœ¬å·¥å…·ç”¨æ–¼å°‡å€‹äººç­†é›»è£œåŠ©è³‡æ–™ï¼ˆåŒ…å«åˆ†æœŸä»˜æ¬¾è³‡è¨Šï¼‰å¾ Excel é·ç§»åˆ° Firestore æ¨¡æ“¬å™¨ã€‚

## ç›®éŒ„çµæ§‹

```
tools/subsidy-migration/
â”œâ”€â”€ excel-to-json.js              # Excel è½‰ JSON é€šç”¨å·¥å…·
â”œâ”€â”€ laptop-subsidy-parser.js      # å€‹äººç­†é›»å°ˆç”¨è§£æå™¨
â”œâ”€â”€ migrate-laptop-subsidies.js   # Firestore é·ç§»è…³æœ¬
â”œâ”€â”€ å€‹äººç­†é›».json                  # Excel åŸå§‹è½‰æ›çš„ JSON
â””â”€â”€ laptop-subsidies.json         # è§£æå¾Œçš„å“¡å·¥è£œåŠ©è³‡æ–™
```

## ä½¿ç”¨æ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¼šå•Ÿå‹• Firebase æ¨¡æ“¬å™¨

åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„åŸ·è¡Œï¼š

```bash
npm start
```

é€™æœƒå•Ÿå‹• Firebase æ¨¡æ“¬å™¨ï¼š
- Auth æ¨¡æ“¬å™¨ï¼šhttp://localhost:9099
- Firestore æ¨¡æ“¬å™¨ï¼šhttp://localhost:8080
- æ¨¡æ“¬å™¨ UIï¼šhttp://localhost:4000

### æ­¥é©Ÿ 2ï¼šå°‡ Excel è½‰æ›ç‚º JSON

```bash
cd tools/subsidy-migration
node excel-to-json.js "../../docs/plans/001-subsidy-application/å€‹äººç­†é›».xlsx"
```

é€™æœƒç”Ÿæˆ `å€‹äººç­†é›».json` æª”æ¡ˆã€‚

### æ­¥é©Ÿ 3ï¼šè§£æå€‹äººç­†é›»è³‡æ–™

```bash
node laptop-subsidy-parser.js å€‹äººç­†é›».json laptop-subsidies.json
```

é€™å€‹æ­¥é©Ÿæœƒï¼š
- è§£ææ¯ä½å“¡å·¥çš„åˆ†æœŸä»˜æ¬¾è³‡è¨Š
- æ”¯æ´å¤šç¨®æ—¥æœŸæ ¼å¼ï¼ˆM/D/YYã€YYYY/MM/DDï¼‰
- è¨ˆç®—æ¯æœŸé‡‘é¡å’Œç¸½é‡‘é¡
- è™•ç†ç™¼ç¥¨é‡‘é¡ï¼ˆå«é€—è™Ÿåˆ†éš”ç¬¦ï¼‰
- è‡ªå‹•åˆ¤æ–·ç”³è«‹æ—¥æœŸï¼ˆç¬¬ä¸€æœŸçš„é ˜å–æ—¥æœŸï¼‰
- é¡¯ç¤ºè©³ç´°çµ±è¨ˆè³‡è¨Š
- è¼¸å‡ºæ¸…ç†å¾Œçš„ JSON æª”æ¡ˆ

è¼¸å‡ºç¯„ä¾‹ï¼š
```
====================================
ğŸ“Š çµ±è¨ˆè³‡è¨Š
====================================
å“¡å·¥ç¸½æ•¸ï¼š10
ç¸½åˆ†æœŸæ•¸ï¼š180 æœŸ
åˆ†æœŸç¯„åœï¼š3 ~ 32 æœŸ
æœ‰ç™¼ç¥¨é‡‘é¡ï¼š8 äºº
ç„¡ç™¼ç¥¨é‡‘é¡ï¼š2 äºº
æ—¥æœŸç¯„åœï¼š2023-05-10 ~ 2025-12-11
åˆ†æœŸç¸½é‡‘é¡ï¼šNT$ 203,000
ç™¼ç¥¨ç¸½é‡‘é¡ï¼šNT$ 541,098

====================================
ğŸ“ å“¡å·¥ç¯„ä¾‹ï¼ˆå‰ 5 ç­†ï¼‰
====================================
 1. èŠæ ¢ç‘ | 19 æœŸ | æœˆä»˜ç¸½è¨ˆ NT$ 19,000 | ç„¡ç™¼ç¥¨ | ç”³è«‹æ—¥æœŸ 2023-05-10
 2. æ—æ‰¿ç¿° | 17 æœŸ | æœˆä»˜ç¸½è¨ˆ NT$ 17,000 | ç„¡ç™¼ç¥¨ | ç”³è«‹æ—¥æœŸ 2023-07-11
 3. å³å¥‡ç‡Š | 32 æœŸ | æœˆä»˜ç¸½è¨ˆ NT$ 42,000 | ç™¼ç¥¨ NT$ 53,900 | ç”³è«‹æ—¥æœŸ 2023-05-10
 4. æå®—ç¿° | 32 æœŸ | æœˆä»˜ç¸½è¨ˆ NT$ 32,000 | ç™¼ç¥¨ NT$ 80,000 | ç”³è«‹æ—¥æœŸ 2023-05-10
 5. ç¿è–å‡± | 25 æœŸ | æœˆä»˜ç¸½è¨ˆ NT$ 31,500 | ç™¼ç¥¨ NT$ 85,900 | ç”³è«‹æ—¥æœŸ 2023-12-07

====================================
ğŸ“… åˆ†æœŸè©³æƒ…ç¯„ä¾‹ï¼ˆèŠæ ¢ç‘ï¼‰
====================================
  ç¬¬  1 æœŸ: 2023-05-10 - NT$ 1,000
  ç¬¬  2 æœŸ: 2023-06-10 - NT$ 1,000
  ç¬¬  3 æœŸ: 2023-07-07 - NT$ 1,000
  ...
```

### æ­¥é©Ÿ 4ï¼šé·ç§»åˆ° Firestore

```bash
node migrate-laptop-subsidies.js laptop-subsidies.json
```

é€™å€‹æ­¥é©Ÿæœƒï¼š
- é€£æ¥åˆ° Firestore æ¨¡æ“¬å™¨ï¼ˆlocalhost:8080ï¼‰
- æ ¹æ“šå§“åæŸ¥è©¢ä½¿ç”¨è€… ID
- å»ºç«‹è£œåŠ©ç”³è«‹è¨˜éŒ„åˆ° `subsidyApplications` é›†åˆ
- åŒ…å«å®Œæ•´çš„åˆ†æœŸä»˜æ¬¾è³‡è¨Š
- å»ºç«‹ç¨½æ ¸è»Œè·¡è¨˜éŒ„
- é¡¯ç¤ºé·ç§»çµæœ

è¼¸å‡ºç¯„ä¾‹ï¼š
```
âœ“ èŠæ ¢ç‘ | 19 æœŸ | æœˆä»˜ NT$ 19,000 | ç„¡ç™¼ç¥¨ â†’ abc123xyz
âœ“ æ—æ‰¿ç¿° | 17 æœŸ | æœˆä»˜ NT$ 17,000 | ç„¡ç™¼ç¥¨ â†’ def456uvw
âœ“ å³å¥‡ç‡Š | 32 æœŸ | æœˆä»˜ NT$ 42,000 | ç™¼ç¥¨ NT$ 53,900 â†’ ghi789rst
...

============================================================
é·ç§»å®Œæˆï¼
============================================================
âœ“ æˆåŠŸ: 10 ç­†
âš  è·³é: 0 ç­†
âœ— å¤±æ•—: 0 ç­†
ç¸½è¨ˆè™•ç†: 10 ç­†

ğŸ“Š è£œåŠ©çµ±è¨ˆ:
  æœˆä»˜ç¸½é¡: NT$ 203,000
  ç™¼ç¥¨ç¸½é¡: NT$ 541,098
  ç¸½åˆ†æœŸæ•¸: 180 æœŸ
```

## è³‡æ–™çµæ§‹

### Excel åŸå§‹è³‡æ–™æ ¼å¼

Excel æª”æ¡ˆæ¡ç”¨ç‰¹æ®Šçš„æ©«å‘åˆ†æœŸçµæ§‹ï¼š

**æ¯ä½å“¡å·¥ä½”æ“š 2-3 åˆ—ï¼š**
1. **ç¬¬ä¸€åˆ—**ï¼šå“¡å·¥è³‡è¨Š + æ¯æœŸçš„é ˜å–æ—¥æœŸ
   - æ¬„ä½ `æœŸæ•¸`ï¼šå“¡å·¥å§“å
   - æ¬„ä½ `æœŸæ•¸_1`ï¼šç™¼ç¥¨é‡‘é¡ï¼ˆä¾‹å¦‚ "53,900" æˆ– "-"ï¼‰
   - æ¬„ä½ `1`, `2`, `3`...`36`ï¼šç¬¬ 1 æœŸã€ç¬¬ 2 æœŸ...ç¬¬ 36 æœŸçš„é ˜å–æ—¥æœŸ
   - æ¬„ä½ `__EMPTY`ï¼šå›ºå®šç‚º "é ˜å–æ—¥æœŸ"

2. **ç¬¬äºŒåˆ—**ï¼ˆå¯é¸ï¼‰ï¼šæ¯æœŸçš„è£œåŠ©é‡‘é¡
   - æ¬„ä½ `1`, `2`, `3`...`36`ï¼šç¬¬ 1 æœŸã€ç¬¬ 2 æœŸ...ç¬¬ 36 æœŸçš„é‡‘é¡
   - æ¬„ä½ `__EMPTY`ï¼šå›ºå®šç‚º "é‡‘é¡"

**ç¯„ä¾‹çµæ§‹ï¼š**
```
| æœŸæ•¸   | 1        | 2        | 3        | ... | æœŸæ•¸_1  | __EMPTY   |
|--------|----------|----------|----------|-----|---------|-----------|
| å³å¥‡ç‡Š | 5/10/23  | 6/10/23  | 7/10/23  | ... | 53,900  | é ˜å–æ—¥æœŸ  |
|        | 1000     | 1000     | 1000     | ... |         | é‡‘é¡      |
```

### è§£æå¾Œçš„è³‡æ–™ (laptop-subsidies.json)

```json
{
  "userName": "å³å¥‡ç‡Š",
  "applicationDate": "2023-05-10",
  "invoiceAmount": 53900,
  "totalMonthlyAmount": 42000,
  "installmentCount": 32,
  "installments": [
    {
      "period": 1,
      "paymentDate": "2023-05-10",
      "amount": 1000
    },
    {
      "period": 2,
      "paymentDate": "2023-06-10",
      "amount": 1000
    }
  ],
  "originalInvoiceAmountStr": "53,900"
}
```

æ¬„ä½èªªæ˜ï¼š
- `userName`ï¼šå“¡å·¥å§“å
- `applicationDate`ï¼šç”³è«‹æ—¥æœŸï¼ˆç¬¬ä¸€æœŸçš„é ˜å–æ—¥æœŸï¼‰
- `invoiceAmount`ï¼šç™¼ç¥¨é‡‘é¡ï¼ˆå¯èƒ½ç‚º nullï¼‰
- `totalMonthlyAmount`ï¼šæœˆä»˜ç¸½é¡ï¼ˆæ‰€æœ‰åˆ†æœŸé‡‘é¡åŠ ç¸½ï¼‰
- `installmentCount`ï¼šåˆ†æœŸæ•¸
- `installments`ï¼šåˆ†æœŸè©³æƒ…é™£åˆ—ï¼ˆé·ç§»æ™‚æœƒè½‰ç‚ºå­é›†åˆï¼‰
  - `period`ï¼šæœŸæ•¸ï¼ˆ1, 2, 3...ï¼‰â†’ å¯«å…¥ Firestore æ™‚ç‚º `installmentNumber`
  - `paymentDate`ï¼šé ˜å–æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰â†’ å¯«å…¥ Firestore æ™‚ç‚º `receivedDate`
  - `amount`ï¼šè©²æœŸé‡‘é¡
- `originalInvoiceAmountStr`ï¼šåŸå§‹ç™¼ç¥¨é‡‘é¡å­—ä¸²

### Firestore è£œåŠ©ç”³è«‹è¨˜éŒ„

```
subsidyApplications/{applicationId}
â”œâ”€â”€ userId: string
â”œâ”€â”€ type: 1 (SubsidyType.Laptop)
â”œâ”€â”€ status: "approved"
â”œâ”€â”€ applicationDate: Timestamp (ç¬¬ä¸€æœŸé ˜å–æ—¥æœŸ)
â”œâ”€â”€ approvedAmount: number (ç™¼ç¥¨é‡‘é¡çš„ 80%ï¼Œä¸Šé™ 54000)
â”œâ”€â”€ content: string ("å€‹äººç­†é›»")
â”œâ”€â”€ notes: string (ç™¼ç¥¨é‡‘é¡ | æ ¸å‡†é‡‘é¡ | åˆ†æœŸæ•¸ | æœˆä»˜ç¸½è¨ˆ)
â”œâ”€â”€ invoiceAmount: number|null (ç™¼ç¥¨é‡‘é¡)
â”œâ”€â”€ installmentCount: number (åˆ†æœŸæ•¸)
â”œâ”€â”€ totalMonthlyAmount: number (æœˆä»˜ç¸½é¡ï¼Œä¾›åƒè€ƒ)
â”œâ”€â”€ createdAt: Timestamp
â”œâ”€â”€ updatedAt: Timestamp
â”œâ”€â”€ installments/ (å­é›†åˆ)
â”‚   â””â”€â”€ {installmentId}
â”‚       â”œâ”€â”€ installmentNumber: number (æœŸæ•¸)
â”‚       â”œâ”€â”€ receivedDate: Timestamp (é ˜å–æ—¥æœŸ)
â”‚       â”œâ”€â”€ amount: number
â”‚       â””â”€â”€ createdAt: Timestamp
â””â”€â”€ auditTrail/ (å­é›†åˆ)
    â””â”€â”€ {auditId}
        â”œâ”€â”€ action: "create"
        â”œâ”€â”€ actionBy: "system"
        â”œâ”€â”€ actionDateTime: Timestamp
        â””â”€â”€ content: string (åŸå§‹è³‡æ–™çš„ JSON)
```

**notes æ¬„ä½ç¯„ä¾‹ï¼š**
```
ç™¼ç¥¨é‡‘é¡: NT$ 53,900 | æ ¸å‡†é‡‘é¡: NT$ 43,120 (ç™¼ç¥¨é‡‘é¡ 80%) | åˆ†æœŸæ•¸: 32 æœŸ | æœˆä»˜ç¸½è¨ˆ: NT$ 42,000
```

æˆ–ï¼ˆç™¼ç¥¨é‡‘é¡è¶…éä¸Šé™çš„æƒ…æ³ï¼‰

```
ç™¼ç¥¨é‡‘é¡: NT$ 85,900 | æ ¸å‡†é‡‘é¡: NT$ 54,000 (ç™¼ç¥¨é‡‘é¡ 80%) | åˆ†æœŸæ•¸: 25 æœŸ | æœˆä»˜ç¸½è¨ˆ: NT$ 31,500
```

æˆ–ï¼ˆç„¡ç™¼ç¥¨çš„æƒ…æ³ï¼‰

```
ç™¼ç¥¨é‡‘é¡: ç„¡ | åˆ†æœŸæ•¸: 19 æœŸ | æœˆä»˜ç¸½è¨ˆ: NT$ 19,000
```

## æ ¸å‡†é‡‘é¡è¨ˆç®—è¦å‰‡

æ ¸å‡†é‡‘é¡è¨ˆç®—é‚è¼¯ï¼š**ç™¼ç¥¨é‡‘é¡çš„ 80%ï¼Œä½†æœ€å¤šä¸è¶…é NT$ 54,000**

### è¨ˆç®—å…¬å¼

```
approvedAmount = Math.min(invoiceAmount Ã— 0.8, 54000)
```

### è¨ˆç®—ç¯„ä¾‹

| ç™¼ç¥¨é‡‘é¡ | è¨ˆç®—éç¨‹ | æ ¸å‡†é‡‘é¡ | èªªæ˜ |
|---------|---------|---------|------|
| NT$ 53,900 | 53,900 Ã— 0.8 = 43,120 | NT$ 43,120 | æœªé”ä¸Šé™ |
| NT$ 80,000 | 80,000 Ã— 0.8 = 64,000 â†’ 54,000 | NT$ 54,000 | è¶…éä¸Šé™ï¼Œå–ä¸Šé™ |
| NT$ 85,900 | 85,900 Ã— 0.8 = 68,720 â†’ 54,000 | NT$ 54,000 | è¶…éä¸Šé™ï¼Œå–ä¸Šé™ |
| NT$ 45,956 | 45,956 Ã— 0.8 = 36,764.8 | NT$ 36,764.8 | æœªé”ä¸Šé™ |
| null (ç„¡ç™¼ç¥¨) | - | null | ç„¡ç™¼ç¥¨å‰‡ç‚º null |

### èˆ‡æœˆä»˜ç¸½é¡çš„é—œä¿‚

- **ç™¼ç¥¨é‡‘é¡**ï¼šç­†é›»çš„å¯¦éš›å”®åƒ¹
- **æ ¸å‡†é‡‘é¡**ï¼šå…¬å¸æ ¸å‡†è£œåŠ©çš„é‡‘é¡ï¼ˆç™¼ç¥¨é‡‘é¡ 80%ï¼Œä¸Šé™ 54000ï¼‰
- **æœˆä»˜ç¸½é¡**ï¼šå¯¦éš›åˆ†æœŸæ”¯ä»˜çµ¦å“¡å·¥çš„é‡‘é¡ï¼ˆåƒ…ä¾›åƒè€ƒï¼‰

**æ³¨æ„ï¼š** æ ¸å‡†é‡‘é¡å’Œæœˆä»˜ç¸½é¡å¯èƒ½ä¸åŒï¼Œæ ¸å‡†é‡‘é¡æ˜¯æ”¿ç­–è¦å®šçš„è£œåŠ©é¡åº¦ã€‚

## ç”³è«‹æ—¥æœŸæ±ºå®šè¦å‰‡

æ ¹æ“šéœ€æ±‚ï¼Œ**ç”³è«‹æ—¥æœŸ = ç¬¬ä¸€æœŸé ˜å–æ—¥æœŸ**ã€‚

è§£æå™¨æœƒè‡ªå‹•æ‰¾å‡ºæ¯ä½å“¡å·¥çš„ç¬¬ä¸€å€‹æœ‰æ•ˆæœŸæ•¸çš„é ˜å–æ—¥æœŸä½œç‚ºç”³è«‹æ—¥æœŸã€‚

**ç¯„ä¾‹ï¼š**
- å³å¥‡ç‡Šç¬¬ 1 æœŸé ˜å–æ—¥æœŸï¼š2023-05-10 â†’ ç”³è«‹æ—¥æœŸï¼š2023-05-10
- ç¿è–å‡±ç¬¬ 1 æœŸé ˜å–æ—¥æœŸï¼š2023-12-07 â†’ ç”³è«‹æ—¥æœŸï¼š2023-12-07

## ç™¼ç¥¨é‡‘é¡è™•ç†

### æœ‰ç™¼ç¥¨é‡‘é¡

Excel ä¸­è¨˜éŒ„ç‚ºå¸¶é€—è™Ÿçš„æ•¸å­—å­—ä¸²ï¼ˆä¾‹å¦‚ "53,900"ï¼‰ï¼š
- è§£æå™¨æœƒç§»é™¤é€—è™Ÿä¸¦è½‰ç‚ºæ•¸å­—
- é·ç§»æ™‚å­˜å…¥ `invoiceAmount` æ¬„ä½

### ç„¡ç™¼ç¥¨é‡‘é¡

Excel ä¸­è¨˜éŒ„ç‚º "-"ï¼š
- è§£æç‚º `null`
- é·ç§»æ™‚ `invoiceAmount` æ¬„ä½ç‚º `null`

## åˆ†æœŸé‡‘é¡æ¨¡å¼

ä¸åŒå“¡å·¥çš„åˆ†æœŸé‡‘é¡æ¨¡å¼ä¸åŒï¼š

### å›ºå®šé‡‘é¡æ¨¡å¼

æ¯æœŸé‡‘é¡éƒ½ç›¸åŒï¼ˆä¾‹å¦‚èŠæ ¢ç‘ã€æ—æ‰¿ç¿°ï¼‰ï¼š
- ç¬¬ 1~19 æœŸï¼šNT$ 1,000

### éšæ¢¯å¼é‡‘é¡æ¨¡å¼

éš¨è‘—æœŸæ•¸å¢åŠ ï¼Œé‡‘é¡æé«˜ï¼ˆä¾‹å¦‚å³å¥‡ç‡Šã€ç¿è–å‡±ï¼‰ï¼š
- ç¬¬ 1~20 æœŸï¼šNT$ 1,000
- ç¬¬ 21~24 æœŸï¼šNT$ 1,500
- ç¬¬ 25~32 æœŸï¼šNT$ 2,000

## æ—¥æœŸæ ¼å¼è™•ç†

### æ”¯æ´çš„æ ¼å¼

è§£æå™¨æ”¯æ´ä»¥ä¸‹æ—¥æœŸæ ¼å¼ï¼š
1. **M/D/YY**ï¼šå–®ä½æ•¸æœˆ/æ—¥ï¼Œä¾‹å¦‚ "5/10/23"
2. **MM/DD/YY**ï¼šå…©ä½æ•¸æœˆ/æ—¥ï¼Œä¾‹å¦‚ "12/24/25"
3. **YYYY/MM/DD**ï¼šå®Œæ•´å¹´ä»½ï¼Œä¾‹å¦‚ "2024/08/02"

### å¹´ä»½åˆ¤æ–·è¦å‰‡

å…©ä½æ•¸å¹´ä»½æœƒæ ¹æ“šä»¥ä¸‹è¦å‰‡è½‰æ›ï¼š
- `00-49` â†’ `2000-2049`
- `50-99` â†’ `1950-1999`

### æ—¥æœŸè½‰æ›ç¯„ä¾‹

```
åŸå§‹æ ¼å¼         è§£æçµæœ
5/10/23      â†’  2023-05-10
12/24/25     â†’  2025-12-24
2024/08/02   â†’  2024-08-02
2025/3/14    â†’  2025-03-14
```

## å¸¸è¦‹å•é¡Œ

### Q1: ç‚ºä»€éº¼æœ‰äº›å“¡å·¥æ²’æœ‰ç™¼ç¥¨é‡‘é¡ï¼Ÿ

æœ‰å…©ç¨®å¯èƒ½ï¼š
1. **å°šæœªæä¾›ç™¼ç¥¨**ï¼šå“¡å·¥å¯èƒ½åˆ†æœŸè³¼è²·ï¼Œç™¼ç¥¨å°šæœªé–‹ç«‹
2. **Excel æ¨™è¨˜ç‚º "-"**ï¼šè¡¨ç¤ºæ²’æœ‰ç™¼ç¥¨æˆ–ä¸é©ç”¨

é€™ä¸å½±éŸ¿é·ç§»ï¼Œç³»çµ±æœƒå°‡ `invoiceAmount` è¨­ç‚º `null`ã€‚

### Q2: æ ¸å‡†é‡‘é¡ã€æœˆä»˜ç¸½é¡å’Œç™¼ç¥¨é‡‘é¡çš„é—œä¿‚ï¼Ÿ

ä¸‰è€…èªªæ˜ï¼š
- **ç™¼ç¥¨é‡‘é¡**ï¼šç­†é›»çš„å¯¦éš›å”®åƒ¹ï¼ˆåŸå§‹ç™¼ç¥¨é‡‘é¡ï¼‰
- **æ ¸å‡†é‡‘é¡**ï¼šå…¬å¸æ”¿ç­–æ ¸å‡†çš„è£œåŠ©é‡‘é¡ï¼ˆç™¼ç¥¨é‡‘é¡ 80%ï¼Œä¸Šé™ 54000ï¼‰
- **æœˆä»˜ç¸½é¡**ï¼šå¯¦éš›åˆ†æœŸæ”¯ä»˜çµ¦å“¡å·¥çš„é‡‘é¡ï¼ˆæ‰€æœ‰åˆ†æœŸåŠ ç¸½ï¼‰

**ç¯„ä¾‹ï¼š**
- å³å¥‡ç‡Šï¼š
  - ç™¼ç¥¨é‡‘é¡ï¼šNT$ 53,900
  - æ ¸å‡†é‡‘é¡ï¼šNT$ 43,120ï¼ˆ53,900 Ã— 0.8ï¼‰
  - æœˆä»˜ç¸½é¡ï¼šNT$ 42,000ï¼ˆ32 æœŸ Ã— 1000 ç­‰ï¼‰

**èªªæ˜ï¼š** æ ¸å‡†é‡‘é¡æ˜¯æ”¿ç­–è¦å®šçš„è£œåŠ©é¡åº¦ï¼Œæœˆä»˜ç¸½é¡æ˜¯å¯¦éš›åŸ·è¡Œçš„åˆ†æœŸä»˜æ¬¾ã€‚

### Q3: åˆ†æœŸæ•¸ä¸åŒä»£è¡¨ä»€éº¼ï¼Ÿ

ä¸åŒå“¡å·¥çš„åˆ†æœŸæ•¸åæ˜ ï¼š
1. **ç”³è«‹æ™‚é–“ä¸åŒ**ï¼šè¼ƒæ—©ç”³è«‹çš„å“¡å·¥æœŸæ•¸è¼ƒå¤š
2. **è£œåŠ©æ–¹æ¡ˆä¸åŒ**ï¼šå¯èƒ½æœ‰ä¸åŒçš„è£œåŠ©æ”¿ç­–
3. **å°šæœªçµæ¸…**ï¼šæ–°é€²å“¡å·¥æœŸæ•¸è¼ƒå°‘

**ç¯„ä¾‹ï¼š**
- å¼µå”å®‰ï¼š3 æœŸï¼ˆ2025-11 ç”³è«‹ï¼Œè¼ƒæ–°ï¼‰
- å³å¥‡ç‡Šï¼š32 æœŸï¼ˆ2023-05 ç”³è«‹ï¼Œè¼ƒæ—©ï¼‰

### Q4: å¦‚ä½•é©—è­‰é·ç§»çµæœï¼Ÿ

1. **æŸ¥çœ‹æ¨¡æ“¬å™¨ UI**ï¼šhttp://localhost:4000/firestore
2. **æª¢æŸ¥ `subsidyApplications` é›†åˆ**ï¼š
   - ç¢ºèªè£œåŠ©é¡å‹ç‚º `1`ï¼ˆLaptopï¼‰
   - æª¢æŸ¥ `installments` é™£åˆ—æ˜¯å¦å®Œæ•´
   - é©—è­‰åˆ†æœŸæ•¸å’Œç¸½é‡‘é¡
3. **æª¢æŸ¥ç¨½æ ¸è»Œè·¡**ï¼š
   - å±•é–‹å–®ç­†è¨˜éŒ„çš„ `auditTrail` å­é›†åˆ
   - ç¢ºèªæœ‰ç³»çµ±å»ºç«‹è¨˜éŒ„

### Q5: å¯ä»¥é‡è¤‡åŸ·è¡Œé·ç§»å—ï¼Ÿ

å¯ä»¥ï¼Œä½†è«‹æ³¨æ„ï¼š
- é‡è¤‡åŸ·è¡Œæœƒå»ºç«‹**æ–°çš„è¨˜éŒ„**
- é€™æœƒå°è‡´é‡è¤‡çš„è£œåŠ©ç”³è«‹
- **å»ºè­°**ï¼šé·ç§»å‰å…ˆæ¸…ç©º `subsidyApplications` é›†åˆ

### Q6: åˆ†æœŸè³‡è¨Šå¦‚ä½•æŸ¥è©¢ï¼Ÿ

Firestore æŸ¥è©¢ç¯„ä¾‹ï¼š

```javascript
// æŸ¥è©¢ç‰¹å®šå“¡å·¥çš„ç­†é›»è£œåŠ©
const subsidies = await db.collection('subsidyApplications')
  .where('userId', '==', userId)
  .where('type', '==', 1)
  .get();

// å–å¾—è£œåŠ©ç”³è«‹è¨˜éŒ„
const applicationDoc = subsidies.docs[0];
const applicationData = applicationDoc.data();

// æŸ¥è©¢åˆ†æœŸè³‡è¨Šå­é›†åˆ
const installmentsSnapshot = await applicationDoc.ref
  .collection('installments')
  .orderBy('installmentNumber', 'asc')
  .get();

const installments = installmentsSnapshot.docs.map(doc => ({
  id: doc.id,
  ...doc.data()
}));

// æŸ¥è©¢ç‰¹å®šæœŸæ•¸
const period5Snapshot = await applicationDoc.ref
  .collection('installments')
  .where('installmentNumber', '==', 5)
  .limit(1)
  .get();
```

## æŠ€è¡“ç´°ç¯€

### è£œåŠ©é¡å‹å®šç¾©

```javascript
const SubsidyType = {
  Laptop: 1,       // å€‹äººç­†é›»
  HealthCheck: 2,  // å¥æª¢
  Training: 3,     // é€²ä¿®èª²ç¨‹
  AITool: 4,       // AI å·¥å…·
  Travel: 5        // æ—…éŠ
};
```

å€‹äººç­†é›»ä½¿ç”¨ `type: 1`ã€‚

### è£œåŠ©ç‹€æ…‹å®šç¾©

```javascript
const SubsidyStatus = {
  Pending: 'pending',     // å¾…å¯©æ ¸
  Approved: 'approved',   // å·²æ ¸å‡†
  Rejected: 'rejected'    // å·²æ‹’çµ•
};
```

æ­·å²è³‡æ–™é è¨­ç‚º `status: 'approved'`ï¼ˆå·²æ ¸å‡†ï¼‰ã€‚

### åˆ†æœŸè³‡è¨Šçµæ§‹

åˆ†æœŸè³‡è¨Šå„²å­˜ç‚º `installments` å­é›†åˆï¼Œæ¯å€‹æ–‡ä»¶çµæ§‹ï¼š

```javascript
installments/{installmentId}
{
  installmentNumber: 1,                         // æœŸæ•¸
  receivedDate: Timestamp.fromDate(new Date()), // é ˜å–æ—¥æœŸ
  amount: 1000,                                 // é‡‘é¡
  createdAt: Timestamp.now()                    // å»ºç«‹æ™‚é–“
}
```

**æ¬„ä½èªªæ˜ï¼š**
- `installmentNumber`ï¼šç¬¬å¹¾æœŸï¼ˆ1, 2, 3...ï¼‰
- `receivedDate`ï¼šè©²æœŸçš„é ˜å–æ—¥æœŸ
- `amount`ï¼šè©²æœŸçš„è£œåŠ©é‡‘é¡
- `createdAt`ï¼šæ–‡ä»¶å»ºç«‹æ™‚é–“

**å„ªé»ï¼š**
- æ”¯æ´æŒ‰æœŸæ•¸æŸ¥è©¢å’Œæ’åº
- ä¾¿æ–¼åˆ†é é¡¯ç¤ºåˆ†æœŸè³‡è¨Š
- ä¸å— Firestore é™£åˆ—å¤§å°é™åˆ¶

### Excel è³‡æ–™è§£æé‚è¼¯

```javascript
// è­˜åˆ¥å“¡å·¥è³‡æ–™åˆ—
if (row['æœŸæ•¸'] && row['__EMPTY'] === 'é ˜å–æ—¥æœŸ') {
  const userName = row['æœŸæ•¸'];
  const invoiceAmount = parseAmount(row['æœŸæ•¸_1']);

  // éæ­·æ‰€æœ‰æœŸæ•¸ï¼ˆ1-36ï¼‰
  for (let period = 1; period <= 36; period++) {
    const dateStr = row[String(period)];
    if (dateStr) {
      // æ‰¾åˆ°è©²æœŸçš„æ—¥æœŸ
      const date = parseDate(dateStr);

      // å¾ä¸‹ä¸€åˆ—æ‰¾é‡‘é¡
      const amountRow = records[i + 1];
      const amount = amountRow[String(period)];
    }
  }
}
```

### ä½¿ç”¨è€… ID å¿«å–

ç‚ºé¿å…é‡è¤‡æŸ¥è©¢ï¼Œè…³æœ¬æœƒå¿«å–ä½¿ç”¨è€… IDï¼š
```javascript
const userCache = {};
userCache[userName] = userId;
```

## é€²éšç”¨æ³•

### åªè§£æä¸é·ç§»

å¦‚æœåªæƒ³æŸ¥çœ‹è³‡æ–™è€Œä¸å¯¦éš›é·ç§»ï¼š

```bash
# åªè§£æï¼Œä¸æŒ‡å®šè¼¸å‡ºæª”æ¡ˆï¼ˆè³‡æ–™æœƒè¼¸å‡ºåˆ°çµ‚ç«¯ï¼‰
node laptop-subsidy-parser.js å€‹äººç­†é›».json
```

### éæ¿¾ç‰¹å®šå“¡å·¥

æ‰‹å‹•ç·¨è¼¯ `laptop-subsidies.json`ï¼Œåªä¿ç•™éœ€è¦çš„è¨˜éŒ„ï¼š

```bash
# ç¯„ä¾‹ï¼šåªä¿ç•™åˆ†æœŸæ•¸å¤§æ–¼ 20 æœŸçš„å“¡å·¥
cat laptop-subsidies.json | jq '[.[] | select(.installmentCount > 20)]' > long-term-only.json
node migrate-laptop-subsidies.js long-term-only.json
```

### åˆ†æåˆ†æœŸé‡‘é¡åˆ†å¸ƒ

```bash
# çµ±è¨ˆæ¯æœŸé‡‘é¡
cat laptop-subsidies.json | jq '[.[] | .installments[] | .amount] | group_by(.) | map({amount: .[0], count: length})'
```

è¼¸å‡ºï¼š
```json
[
  {"amount": 1000, "count": 145},
  {"amount": 1500, "count": 23},
  {"amount": 2000, "count": 12}
]
```

### æŸ¥è©¢ç‰¹å®šæ—¥æœŸç¯„åœ

```bash
# æŸ¥è©¢ 2024 å¹´ç”³è«‹çš„å“¡å·¥
cat laptop-subsidies.json | jq '[.[] | select(.applicationDate | startswith("2024"))]'
```

## æ³¨æ„äº‹é …

### é‡è¦æé†’

1. **æ¨¡æ“¬å™¨é€£ç·š**
   - ç¢ºä¿ Firebase æ¨¡æ“¬å™¨æ­£åœ¨é‹è¡Œï¼ˆ`npm start`ï¼‰
   - ç¢ºèª Firestore æ¨¡æ“¬å™¨åœ¨ port 8080

2. **ä½¿ç”¨è€…åŒ¹é…**
   - ç¢ºä¿ç³»çµ±ä¸­æœ‰å°æ‡‰çš„ä½¿ç”¨è€…è³‡æ–™ï¼ˆ`users` é›†åˆï¼‰
   - ä½¿ç”¨è€…åç¨±å¿…é ˆå®Œå…¨ç›¸ç¬¦ï¼ˆå€åˆ†å¤§å°å¯«ï¼‰

3. **è³‡æ–™å‚™ä»½**
   - é·ç§»å‰å»ºè­°å…ˆå‚™ä»½æ¨¡æ“¬å™¨è³‡æ–™
   - å¯ä½¿ç”¨ `sync-from-prod.js` å¾æ­£å¼ç’°å¢ƒåŒæ­¥è³‡æ–™

4. **é‡è¤‡åŸ·è¡Œ**
   - é‡è¤‡åŸ·è¡Œæœƒå»ºç«‹é‡è¤‡è¨˜éŒ„
   - å»ºè­°æ¸…ç©º `subsidyApplications` é›†åˆå¾Œé‡æ–°åŸ·è¡Œ

5. **åˆ†æœŸè³‡è¨Šå®Œæ•´æ€§**
   - æ‰€æœ‰åˆ†æœŸè³‡è¨Šå„²å­˜åœ¨ `installments` å­é›†åˆä¸­
   - å¯ç”¨æ–¼å±•ç¤ºåˆ†æœŸæ˜ç´°ã€è¨ˆç®—å‰©é¤˜æœŸæ•¸
   - æ”¯æ´éˆæ´»çš„æŸ¥è©¢å’Œæ’åº

### è³‡æ–™å®Œæ•´æ€§é©—è­‰

é·ç§»å¾Œå»ºè­°é©—è­‰ï¼š
- âœ… å“¡å·¥æ•¸é‡æ˜¯å¦æ­£ç¢ºï¼ˆ10 äººï¼‰
- âœ… `approvedAmount` è¨ˆç®—æ­£ç¢ºï¼ˆç™¼ç¥¨é‡‘é¡ 80%ï¼Œä¸Šé™ 54000ï¼‰
- âœ… ç™¼ç¥¨é‡‘é¡æ˜¯å¦æ­£ç¢ºå­˜å…¥
- âœ… `installments` å­é›†åˆæ˜¯å¦å®Œæ•´å»ºç«‹
- âœ… æ¯ä½å“¡å·¥çš„åˆ†æœŸæ•¸æ˜¯å¦æ­£ç¢º
- âœ… åˆ†æœŸè³‡è¨Šçš„ `installmentNumber`ã€`receivedDate`ã€`amount` æ˜¯å¦æ­£ç¢º
- âœ… notes æ¬„ä½åŒ…å«æ ¸å‡†é‡‘é¡è³‡è¨Š

### æ•ˆèƒ½è€ƒé‡

- **ä½¿ç”¨è€…å¿«å–**ï¼šé¿å…é‡è¤‡æŸ¥è©¢ç›¸åŒä½¿ç”¨è€…
- **æ‰¹æ¬¡è™•ç†**ï¼šæ¯ç­†è¨˜éŒ„ç¨ç«‹è™•ç†ï¼Œå¤±æ•—ä¸å½±éŸ¿å…¶ä»–è¨˜éŒ„
- **åˆ†æœŸè³‡è¨Š**ï¼šä»¥é™£åˆ—å½¢å¼å­˜å„²ï¼Œä¾¿æ–¼æŸ¥è©¢å’Œå±•ç¤º

## æ•…éšœæ’é™¤

### Excel çµæ§‹ç•°å¸¸

**å•é¡Œ**ï¼šè§£æå¤±æ•—æˆ–è³‡æ–™ä¸å®Œæ•´

**å¯èƒ½åŸå› **ï¼š
- Excel å·¥ä½œè¡¨çµæ§‹æ”¹è®Š
- æ–°å¢æˆ–åˆªé™¤äº†æ¬„ä½
- æœŸæ•¸è¶…é 36 æœŸ

**è§£æ±ºæ–¹æ³•**ï¼š
1. æª¢æŸ¥ Excel æª”æ¡ˆçµæ§‹æ˜¯å¦ç¬¦åˆé æœŸ
2. ç¢ºèªæ¬„ä½åç¨±ï¼ˆ`æœŸæ•¸`ã€`æœŸæ•¸_1`ã€`__EMPTY`ï¼‰æ˜¯å¦æ­£ç¢º
3. æŸ¥çœ‹ `å€‹äººç­†é›».json` ç¢ºèªè½‰æ›çµæœ

### æ—¥æœŸè§£æå¤±æ•—

**å•é¡Œ**ï¼šé¡¯ç¤ºã€Œç„¡æ³•è§£ææ—¥æœŸã€è­¦å‘Š

**å¯èƒ½åŸå› **ï¼š
- æ—¥æœŸæ ¼å¼ä¸ç¬¦åˆæ”¯æ´çš„æ ¼å¼
- æ—¥æœŸåŒ…å«é¡å¤–ç©ºç™½æˆ–ç‰¹æ®Šå­—å…ƒ
- Excel è½‰æ›éç¨‹ä¸­æ ¼å¼æ”¹è®Š

**è§£æ±ºæ–¹æ³•**ï¼š
1. æª¢æŸ¥ Excel åŸå§‹æª”æ¡ˆçš„æ—¥æœŸæ ¼å¼
2. æ‰‹å‹•ä¿®æ­£ `å€‹äººç­†é›».json` ä¸­çš„å•é¡Œæ—¥æœŸ
3. é‡æ–°åŸ·è¡Œè§£æå™¨

### é‡‘é¡è¨ˆç®—éŒ¯èª¤

**å•é¡Œ**ï¼šæœˆä»˜ç¸½é¡èˆ‡é æœŸä¸ç¬¦

**å¯èƒ½åŸå› **ï¼š
- é‡‘é¡åˆ—ç¼ºå¤±æˆ–æ ¼å¼éŒ¯èª¤
- æŸäº›æœŸæ•¸çš„é‡‘é¡ç‚º null

**è§£æ±ºæ–¹æ³•**ï¼š
1. æª¢æŸ¥ Excel ä¸­æ¯æœŸçš„é‡‘é¡æ˜¯å¦æ­£ç¢º
2. ç¢ºèªé‡‘é¡åˆ—çš„ `__EMPTY` æ¬„ä½ç‚º "é‡‘é¡"
3. æŸ¥çœ‹è§£æå¾Œçš„ `installments` é™£åˆ—

### æ‰¾ä¸åˆ°ä½¿ç”¨è€…

**å•é¡Œ**ï¼šé·ç§»æ™‚é¡¯ç¤ºã€Œæ‰¾ä¸åˆ°ä½¿ç”¨è€… XXXã€

**è§£æ±ºæ–¹æ³•**ï¼š
1. æª¢æŸ¥ `users` é›†åˆæ˜¯å¦æœ‰è©²ä½¿ç”¨è€…
2. ç¢ºèªå§“åæ‹¼å¯«æ˜¯å¦æ­£ç¢º
3. ç¢ºèªä½¿ç”¨è€…æ˜¯å¦å·²å•Ÿç”¨

## ç›¸é—œæª”æ¡ˆ

- **å¯¦ä½œè¨ˆç•«**ï¼š`docs/plans/001-subsidy-application/SUBSIDY_IMPLEMENTATION_PLAN.md`
- **Excel åŸå§‹æª”**ï¼š`docs/plans/001-subsidy-application/å€‹äººç­†é›».xlsx`
- **åŒæ­¥å·¥å…·èªªæ˜**ï¼š`tools/subsidy-migration/README_SYNC.md`
- **åˆé¤è£œåŠ©é·ç§»**ï¼š`tools/subsidy-migration/README_MEAL.md`
- **é€²ä¿®èª²ç¨‹é·ç§»**ï¼š`tools/subsidy-migration/README_TRAINING.md`
- **æ—…éŠè£œåŠ©é·ç§»**ï¼š`tools/subsidy-migration/README_TRAVEL.md`

## å®Œæ•´å·¥ä½œæµç¨‹ç¯„ä¾‹

```bash
# 1. å•Ÿå‹•æ¨¡æ“¬å™¨ï¼ˆåœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„ï¼‰
npm start

# 2. åˆ‡æ›åˆ°å·¥å…·ç›®éŒ„
cd tools/subsidy-migration

# 3. Excel è½‰ JSON
node excel-to-json.js "../../docs/plans/001-subsidy-application/å€‹äººç­†é›».xlsx"

# 4. è§£æè³‡æ–™
node laptop-subsidy-parser.js å€‹äººç­†é›».json laptop-subsidies.json

# 5. æŸ¥çœ‹è§£æçµæœï¼ˆå¯é¸ï¼‰
cat laptop-subsidies.json | jq '.[0]' # æŸ¥çœ‹ç¬¬ä¸€ç­†è³‡æ–™

# 6. åŸ·è¡Œé·ç§»
node migrate-laptop-subsidies.js laptop-subsidies.json

# 7. é©—è­‰çµæœï¼ˆé–‹å•Ÿç€è¦½å™¨ï¼‰
open http://localhost:4000/firestore
```

## è³‡æ–™çµ±è¨ˆç¯„ä¾‹

### æŒ‰åˆ†æœŸæ•¸çµ±è¨ˆ

```bash
cat laptop-subsidies.json | jq 'group_by(.installmentCount) | map({installments: .[0].installmentCount, count: length, employees: map(.userName)})'
```

### æŒ‰ç”³è«‹æ™‚é–“çµ±è¨ˆ

```bash
cat laptop-subsidies.json | jq 'group_by(.applicationDate | split("-")[0]) | map({year: .[0].applicationDate | split("-")[0], count: length})'
```

### ç™¼ç¥¨é‡‘é¡çµ±è¨ˆ

```bash
cat laptop-subsidies.json | jq '{total: (map(.invoiceAmount // 0) | add), avg: (map(.invoiceAmount // 0) | add / length)}'
```

## æ›´æ–°æ—¥èªŒ

### ç•¶å‰ç‰ˆæœ¬
- âœ… æ”¯æ´ M/D/YY å’Œ YYYY/MM/DD æ—¥æœŸæ ¼å¼
- âœ… è™•ç†åˆ†æœŸä»˜æ¬¾è³‡è¨Šï¼ˆæœ€å¤š 36 æœŸï¼‰
- âœ… æ”¯æ´éšæ¢¯å¼é‡‘é¡æ¨¡å¼
- âœ… ç™¼ç¥¨é‡‘é¡è§£æï¼ˆå«é€—è™Ÿè™•ç†ï¼‰
- âœ… è‡ªå‹•åˆ¤æ–·ç”³è«‹æ—¥æœŸï¼ˆç¬¬ä¸€æœŸé ˜å–æ—¥æœŸï¼‰
- âœ… å®Œæ•´çš„åˆ†æœŸè³‡è¨Šå­˜å„²
- âœ… ä½¿ç”¨è€… ID å¿«å–æœ€ä½³åŒ–
- âœ… è©³ç´°çš„çµ±è¨ˆè³‡è¨Šå’Œæ‘˜è¦
- âœ… å®Œæ•´çš„éŒ¯èª¤è™•ç†å’Œå ±å‘Š
- âœ… ç¨½æ ¸è»Œè·¡è¨˜éŒ„
