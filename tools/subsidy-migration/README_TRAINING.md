# é€²ä¿®èª²ç¨‹è£œåŠ©é·ç§»å·¥å…·

æœ¬å·¥å…·ç”¨æ–¼å°‡é€²ä¿®èª²ç¨‹è£œåŠ©è³‡æ–™å¾ Excel é·ç§»åˆ° Firestore æ¨¡æ“¬å™¨ã€‚

## ç›®éŒ„çµæ§‹

```
tools/subsidy-migration/
â”œâ”€â”€ excel-to-json.js              # Excel è½‰ JSON é€šç”¨å·¥å…·
â”œâ”€â”€ training-course-parser.js     # é€²ä¿®èª²ç¨‹å°ˆç”¨è§£æå™¨
â”œâ”€â”€ migrate-training-courses.js   # Firestore é·ç§»è…³æœ¬
â”œâ”€â”€ é€²ä¿®èª²ç¨‹.json                  # è§£æå¾Œçš„ JSON æª”æ¡ˆ
â””â”€â”€ training-courses.json         # æ¸…ç†å¾Œçš„èª²ç¨‹è³‡æ–™
```

## ä½¿ç”¨æ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¼šå•Ÿå‹• Firebase æ¨¡æ“¬å™¨

åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„åŸ·è¡Œï¼š

```bash
npm start
```

é€™æœƒå•Ÿå‹• Firebase æ¨¡æ“¬å™¨ï¼š
- Auth æ¨¡æ“¬å™¨ï¼šhttp://localhost:9099
- Firestore æ¨¡æ“¬å™¨ï¼šhttp://localhost:8080

### æ­¥é©Ÿ 2ï¼šå°‡ Excel è½‰æ›ç‚º JSON

```bash
cd tools/subsidy-migration
node excel-to-json.js "../../docs/plans/001-subsidy-application/é€²ä¿®èª²ç¨‹.xlsx"
```

é€™æœƒç”Ÿæˆ `é€²ä¿®èª²ç¨‹.json` æª”æ¡ˆã€‚

### æ­¥é©Ÿ 3ï¼šè§£æé€²ä¿®èª²ç¨‹è³‡æ–™

```bash
node training-course-parser.js é€²ä¿®èª²ç¨‹.json training-courses.json
```

é€™å€‹æ­¥é©Ÿæœƒï¼š
- è§£æå„ç¨®æ—¥æœŸæ ¼å¼
- è™•ç†å§“åç‚º null çš„æƒ…æ³ï¼ˆä½¿ç”¨å‰ä¸€ç­†çš„å§“åï¼‰
- éæ¿¾ç„¡æ•ˆè¨˜éŒ„
- è¨ˆç®—ç¸½è²»ç”¨
- é¡¯ç¤ºçµ±è¨ˆè³‡è¨Š
- è¼¸å‡ºæ¸…ç†å¾Œçš„ JSON æª”æ¡ˆ

è¼¸å‡ºç¯„ä¾‹ï¼š
```
ğŸ“Š çµ±è¨ˆè³‡è¨Š
============================================================
åŸå§‹è³‡æ–™æ•¸ï¼š127
æœ‰æ•ˆèª²ç¨‹æ•¸ï¼š101
ç”³è«‹äººæ•¸ï¼š28
èª²ç¨‹ç¨®é¡ï¼š65
æ—¥æœŸç¯„åœï¼š2023-04-23 ~ 2025-11-13
ç”³è«‹ç¸½é¡ï¼šNT$ 232,232.2
å¯¦éš›ç¸½è²»ç”¨ï¼šNT$ 425,685
```

### æ­¥é©Ÿ 4ï¼šé·ç§»åˆ° Firestore

```bash
node migrate-training-courses.js training-courses.json
```

é€™å€‹æ­¥é©Ÿæœƒï¼š
- é€£æ¥åˆ° Firestore æ¨¡æ“¬å™¨ï¼ˆlocalhost:8080ï¼‰
- æ ¹æ“šå§“åæŸ¥è©¢ä½¿ç”¨è€… ID
- å»ºç«‹è£œåŠ©ç”³è«‹è¨˜éŒ„åˆ° `subsidyApplications` é›†åˆ
- å»ºç«‹ç¨½æ ¸è»Œè·¡è¨˜éŒ„
- é¡¯ç¤ºé·ç§»çµæœ

è¼¸å‡ºç¯„ä¾‹ï¼š
```
============================================================
é·ç§»å®Œæˆï¼
============================================================
âœ“ æˆåŠŸ: 93 ç­†
âš  è·³é: 8 ç­†
âœ— å¤±æ•—: 0 ç­†
ç¸½è¨ˆè™•ç†: 101 ç­†
```

## è³‡æ–™çµæ§‹

### è§£æå¾Œçš„èª²ç¨‹è³‡æ–™ (training-courses.json)

```json
{
  "userName": "ç¿è–å‡±",
  "applicationDate": "2023-11-08",
  "courseName": "MWC è»Ÿé«”é–‹ç™¼è€…çš„å¹´åº¦æŠ€è¡“å˜‰å¹´è¯",
  "invoiceAmount": 4200,
  "travelExpense": null,
  "accommodation": null,
  "totalExpense": 4200,
  "appliedAmount": 1680,
  "issuanceDate": "2023-11-10"
}
```

### Firestore è£œåŠ©ç”³è«‹è¨˜éŒ„

```
subsidyApplications/{applicationId}
â”œâ”€â”€ userId: string
â”œâ”€â”€ type: 3 (SubsidyType.Training)
â”œâ”€â”€ status: "approved"
â”œâ”€â”€ applicationDate: Timestamp
â”œâ”€â”€ approvedAmount: number
â”œâ”€â”€ content: string (èª²ç¨‹åç¨±)
â”œâ”€â”€ invoiceAmount: number
â”œâ”€â”€ notes: string (åŒ…å«æ ¸ç™¼æ—¥æœŸã€è»Šé¦¬è²»ã€ä½å®¿ç­‰è³‡è¨Š)
â”œâ”€â”€ createdAt: Timestamp
â”œâ”€â”€ updatedAt: Timestamp
â””â”€â”€ auditTrail/ (å­é›†åˆ)
    â””â”€â”€ {auditId}
        â”œâ”€â”€ action: "create"
        â”œâ”€â”€ actionBy: "system"
        â”œâ”€â”€ actionDateTime: Timestamp
        â””â”€â”€ content: string (åŸå§‹è³‡æ–™çš„ JSON)
```

## å¸¸è¦‹å•é¡Œ

### Q1: ç‚ºä»€éº¼æœ‰äº›è¨˜éŒ„è¢«è·³éï¼Ÿ

æœ‰ä»¥ä¸‹å¹¾ç¨®å¯èƒ½ï¼š
1. **æ‰¾ä¸åˆ°ä½¿ç”¨è€…**ï¼šä½¿ç”¨è€…å¯èƒ½å·²é›¢è·æˆ–ä¸åœ¨ç³»çµ±ä¸­
2. **ç¼ºå°‘å¿…è¦æ¬„ä½**ï¼šèª²ç¨‹åç¨±ã€ç”³è«‹æ—¥æœŸã€ä½¿ç”¨è€…åç¨±ç‚ºç©º
3. **ç”³è«‹é‡‘é¡ç‚º 0**ï¼šæ²’æœ‰å¯¦éš›ç”³è«‹è£œåŠ©

### Q2: å¦‚ä½•è™•ç†æ—¥æœŸæ ¼å¼éŒ¯èª¤ï¼Ÿ

è§£æå™¨æ”¯æ´ä»¥ä¸‹æ ¼å¼ï¼š
- `YYYY/MM/DD`ï¼šå¦‚ "2023/11/08"
- `M/D/YY`ï¼šå¦‚ "11/10/23"

å¦‚æœé‡åˆ°ç„¡æ³•è§£æçš„æ—¥æœŸæ ¼å¼ï¼Œè©²ç­†è¨˜éŒ„æœƒè¢«è·³éä¸¦é¡¯ç¤ºè­¦å‘Šã€‚

### Q3: è»Šé¦¬è²»å’Œä½å®¿è²»ç”¨å¦‚ä½•å„²å­˜ï¼Ÿ

é€™äº›è³‡è¨Šæœƒæ•´åˆåˆ° `notes` æ¬„ä½ä¸­ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
```
æ ¸ç™¼æ—¥æœŸ: 2023-11-10 | è»Šé¦¬è²»: NT$ 2660 | ä½å®¿: NT$ 0 | ç¸½è²»ç”¨: NT$ 6260
```

### Q4: å¦‚ä½•é©—è­‰é·ç§»çµæœï¼Ÿ

1. æŸ¥çœ‹ Firestore æ¨¡æ“¬å™¨ UIï¼šhttp://localhost:8080
2. æª¢æŸ¥ `subsidyApplications` é›†åˆ
3. ç¢ºèªè¨˜éŒ„æ•¸é‡å’Œé‡‘é¡æ˜¯å¦æ­£ç¢º

## æŠ€è¡“ç´°ç¯€

### è£œåŠ©é¡å‹å®šç¾©

```javascript
const SubsidyType = {
  Laptop: 1,       // å€‹äººç­†é›»
  HealthCheck: 2,  // å¥æª¢
  Training: 3,     // é€²ä¿®èª²ç¨‹
  AITool: 4,       // AI å·¥å…·
  Travel: 5        // æ—…éŠ
};
```

### è£œåŠ©ç‹€æ…‹å®šç¾©

```javascript
const SubsidyStatus = {
  Pending: 'pending',     // å¾…å¯©æ ¸
  Approved: 'approved',   // å·²æ ¸å‡†
  Rejected: 'rejected'    // å·²æ‹’çµ•
};
```

## æ³¨æ„äº‹é …

1. **æ¨¡æ“¬å™¨é€£ç·š**ï¼šç¢ºä¿ Firebase æ¨¡æ“¬å™¨æ­£åœ¨é‹è¡Œ
2. **ä½¿ç”¨è€…åŒ¹é…**ï¼šç¢ºä¿ç³»çµ±ä¸­æœ‰å°æ‡‰çš„ä½¿ç”¨è€…è³‡æ–™
3. **è³‡æ–™å‚™ä»½**ï¼šé·ç§»å‰å»ºè­°å…ˆå‚™ä»½ç¾æœ‰è³‡æ–™
4. **é‡è¤‡åŸ·è¡Œ**ï¼šé‡è¤‡åŸ·è¡Œæœƒå»ºç«‹é‡è¤‡çš„è¨˜éŒ„ï¼Œè«‹æ³¨æ„æ¸…ç†

## ç›¸é—œæª”æ¡ˆ

- å¯¦ä½œè¨ˆç•«ï¼š`docs/plans/001-subsidy-application/SUBSIDY_IMPLEMENTATION_PLAN.md`
- Excel åŸå§‹æª”ï¼š`docs/plans/001-subsidy-application/é€²ä¿®èª²ç¨‹.xlsx`
- å¿«é€Ÿå•Ÿå‹•æŒ‡å—ï¼š`tools/subsidy-migration/QUICK_START.md`ï¼ˆåˆé¤è¨‚è³¼ï¼‰
